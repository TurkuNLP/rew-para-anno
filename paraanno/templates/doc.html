<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" crossorigin="anonymous">
    <title>Para-anno</title>

    <style>
      span.matched {color:darkgrey};
    </style>
    
  </head>
  <body>


    <div class="container">

      <ol class="breadcrumb">
	<li class="breadcrumb-item"><a href="{{app_root}}/">home</a></li>
	  <li class="breadcrumb-item"><a href="{{app_root}}/ann/{{user}}">{{user}}</a></li>
	  <li class="breadcrumb-item"><a href="{{app_root}}/ann/{{user}}/{{batchfile}}">{{batchfile}}</a></li>
	  <li class="breadcrumb-item active"><a href="{{app_root}}/ann/{{user}}/{{batchfile}}/{{pairseq}}">{{pairseq}}</a></li>
	</ol>
      
      <div class="row">
	<div class="col-12 p-1 m-2 border border-primary rounded">
	  <span id="text-left">{{text1}}</span>
	</div>
	
	<div class="col-12 p-1 m-2 mt-4 border border-primary rounded">
	  <span id="text-right">{{text2}}</span>
	</div>
      </div> <!-- row-->


      <!-- {% for label,labeldesc in labels %} -->
      <!-- <div class="row"> -->
      <!-- 	<div class="col-12 p-1 ml-2 mt-3"> -->
      <!-- 	  <input class="input autosave" type="radio" name="labelradio" id="labelradio" value="{{label}}" {% if label==annotation["label"] %}checked{% endif %}> {{labeldesc}} </input> -->
      <!-- 	</div> -->
      <!-- </div> -->
      <!-- {% endfor %} -->

     
      <div class="row mt-4 mb-4">
	<div class="col-1">
	  <b>Label</b>
	</div>
	<div class="col-2">
	  <textarea class="autosave" style="width:100%;" id="label">{{annotation["label"]}}</textarea>
	</div>
	<div class="col-1">
	</div>

	<div class="col-4">
	  <ul style="list-style-type:none;">
	    {% for l,d in (("4","Paraphrase"),("4<","Upper is more general"),("4>","Lower is more general"),("3","Paraphrase here but not in general"),("2","Related but not paraphrase"),("1","Unrelated"),("x","Skip")) %}
	      <li> <span class="badge badge-success">{{l}}</span> : {{d}} </li>
	    {% endfor %}
	  </ul>
	</div>

	<div class="col-4">
	  <ul style="list-style-type:none;">
	    {% for l,d in (("s","Style (tone or register)"),("i","Diff in number, person, etc")) %}
	      <li> <span class="badge badge-success">{{l}}</span> : {{d}} </li>
	    {% endfor %}
	  </ul>
	</div>
	
      </div> <!-- Row -->
      
      <div class="row mt-3 mb-1">
	<div class="col-3">
	  <button type="button" id="copyandrewbtn" class="btn btn-lg btn-info">Copy to rewrite</button>
	</div>

	<div class="col-3">
	  <button type="button" id="wipebtn" class="btn btn-lg btn-info">Wipe</button>
	</div>

      </div>

      
      <div class="row">
	<div class="col-12 p-1 m-2" style="">
	  <textarea class="editdirty" style="width:100%;"  id="text-rew-left">{% if "rew1" in annotation %}{{annotation["rew1"]}}{% endif %}</textarea>
	</div>
	
	<div class="col-12 p-1 m-2" style="">
	  <textarea class="editdirty" style="width:100%;"  id="text-rew-right">{% if "rew2" in annotation %}{{annotation["rew2"]}}{% endif %}</textarea>
	</div>

      </div> <!-- row-->


      
     <div class="row">
	<div class="col-1 p-1">
	  {% if pairseq > 0 %}<a type="button" class="btn btn-lg btn-info" id="prevdoc" href="{{app_root}}/ann/{{user}}/{{batchfile}}/{{pairseq-1}}"><span class="fa fa-chevron-left"/></a>&nbsp;{% endif %}
	</div>
	<div class="col-1 p-1">
	  {% if not is_last %}<a type="button" class="btn btn-lg btn-info" id="nextdoc" href="{{app_root}}/ann/{{user}}/{{batchfile}}/{{pairseq+1}}"><span class="fa fa-chevron-right"/></a>&nbsp;{% endif %}
	</div>
	<div class="col-1$ p-1">
	  <button type="button" class="btn btn-lg btn-info" id="save">Save</button>
	</div>
      </div>

	  <!-- here go the annotations! -->
	  
	</div> <!-- container -->
      </div> <!-- row-->
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>

    <script>

      localStorage.setItem('docpairpath', '{{user}}/{{batchfile}}/{{pairseq}}');
      localStorage.setItem('username','{{user}}');

      function dirty() {
	  $("#prevdoc").addClass("disabled");
	  $("#nextdoc").addClass("disabled");
	  $("#save").css("background-color","");
	  
      }

      function wipe_rew() {
	  $("#text-rew-left").val("");
	  $("#text-rew-right").val("");
	  dirty();
      }

      function clean() {
	  $("#prevdoc").removeClass("disabled");
	  $("#nextdoc").removeClass("disabled");
      }
	  
      function copy_to_rewrite() {
	  var t1=$("#text-left").text();
	  var t2=$("#text-right").text();
	  $("#text-rew-left").val(t1);
	  $("#text-rew-right").val(t2)
	  dirty();
      }

      
      function get_all_data() {
	  var anns={};
	  anns["label"]=$("#label").val();
	  anns["rew1"]=$("#text-rew-left").val();
	  anns["rew2"]=$("#text-rew-right").val();
	  anns["user"]=localStorage.getItem('username');
	  return anns;
      }

      function save_data() {
	  var all_data=get_all_data();
	  var docpairpath = localStorage.getItem('docpairpath');
	  $.ajax({type: 'POST',
		  url: "{{app_root}}/saveann/"+docpairpath,
		  data: JSON.stringify(all_data),
		  contentType: 'application/json',
		  error: function () { $("#save").css("background-color","red"); },
		  success: function () { $("#save").css("background-color","green"); }
		 }
	  );
	      
	  clean();
      }


      $(document).ready(
	  function() {
	      $("#save").on("click",save_data);
	      $("#copyandrewbtn").on("click",copy_to_rewrite);
	      $("#wipebtn").on("click",wipe_rew);
	  }
      );

      $(document).on("input",".editdirty",dirty);
      $(document).on("input",".autosave",save_data);

      </script>

    
  </body>
</html>
